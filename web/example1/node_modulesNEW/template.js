const STATE = require('STATE')
const statedb = STATE(__filename)
const { sdb, subs: [get] } = statedb(fallback_module)

/******************************************************************************
  PAGE
******************************************************************************/
const sub_module = require('sub_module_address')

module.exports = module_name
async function module_name(opts) {
  // ----------------------------------------
  // ID + JSON STATE
  // ----------------------------------------
  const { id, sdb } = await get(opts.sid) // hub is "parent's" io "id" to send/receive messages
  const on = {
    theme: inject,
    lang: fill
  }
  // ----------------------------------------
  // TEMPLATE
  // ----------------------------------------
  const el = document.createElement('div')
  const shopts = { mode: 'closed' }
  const shadow = el.attachShadow(shopts)
  shadow.innerHTML = `
    <style></style>`
  const style = shadow.querySelector('style')
  const subs = await sdb.watch(onbatch)
  // ----------------------------------------
  // ELEMENTS
  // ----------------------------------------
  {
    shadow.append(await sub_module(subs[0]))
  }
  return el

  function onbatch(batch){
    for (const {type, data} of batch) {
      on[type](data)
    }
  }
  async function inject (data){
    style.innerHTML = data.join('\n')
  }
  async function fill([data]) {
  }
}


function fallback_module () {
  return {
    api: fallback_instance,
    _: {
      sub_module_name: {
        $: ''
      }
    },
    drive: {
      dataset_name: {
        file_name: {
          raw: {}
        }
      }
    }
  }
  function fallback_instance () {
    return {
      _: {
        sub_module_name: {
          0: ''
        }
      },
      drive: {
        dataset_name: {
          file_name: {
            raw: {}
          }
        }
      }
    }
  }
}